<html>
  <body bgcolor=black text=white>
	
<center>
<div id="message"><font color=black>-</font></div><br>
<img height=58% src="" id="myImageA" onclick="bigA()"/><br><br>
<img height=10% src="" id="myImageB" onclick="bigB()"/><br><br>
<img height=10% src="" id="myImageC" onclick="bigC()"/><br><br>
<img height=10% src="" id="myImageD" onclick="bigD()"/>
</center>

<script>

  var lastActivity = Date.now();

  // 5 minutes
  var sleepAfterIdleSeconds = 60 * 5;

  var sleeping = false;

  var loadingFlags=[ 0, 0, 0, 0 ];

  function doneLoading(i) {
	  loadingFlags[i] = 0;
  }

  function resetLoadingFlags() {
	  loadingFlags[0] =  1;
	  loadingFlags[1] =  1;
      loadingFlags[2] =  1;
      loadingFlags[3] =  1;
  }
  
  
  
  var urlA = "http://192.168.88.230:88/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2&usr=admin&pwd="
  var urlB = "http://192.168.88.231:88/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2&usr=admin&pwd="
  var urlC = "http://192.168.88.232:88/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2&usr=admin&pwd="
  var urlD = "http://192.168.88.219:88/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2&usr=admin&pwd=admin"
  
  var myImageElementA = document.getElementById('myImageA');
  myImageElementA.onload = function() { doneLoading(0) };
  myImageElementA.src = urlA + '&rand=' + Math.random();
  
  var myImageElementB = document.getElementById('myImageB');
  myImageElementB.onload = function() { doneLoading(1) };
  myImageElementB.src = urlB + '&rand=' + Math.random();
  
  
  var myImageElementC = document.getElementById('myImageC');
  myImageElementC.onload = function() { doneLoading(2) };
  myImageElementC.src = urlC + '&rand=' + Math.random();

  var myImageElementD = document.getElementById('myImageD');
  myImageElementD.onload = function() { doneLoading(3) };
  myImageElementD.src = urlD + '&rand=' + Math.random();

  

  function blinkSleepingMessage() {
	  var div = document.getElementById('sleepCellA');
	  if( div != null ) {
		  div.style.visibility = 
			  (div.style.visibility == 'hidden' ? '' : 'hidden');
		  
		  div = document.getElementById('sleepCellB');
		  div.style.visibility = 
			  (div.style.visibility == 'hidden' ? '' : 'hidden');
		  
		  if( sleeping ) {
			  setTimeout( blinkSleepingMessage, 1000 );
		  }
	  }
  }


  function periodicReload() {
	  // note that we must wait until the last reload is complete before
	  // changing the img src URLs again and triggering a new reload

	  // If we just run this on a timer every 500 ms, and the reloads take
	  // longer than that, they seem to pile up.  The images update
	  // erratically in the browser in that case.
	  
      if ( loadingFlags[0] || loadingFlags[1] || loadingFlags[2] ||
		   loadingFlags[3] ) {
		  // wait longer
		  setTimeout( periodicReload, 50 );
		  return;
	  }
	  
	  
	  
	  if( Date.now() - lastActivity > sleepAfterIdleSeconds * 1000 ) {
		  // time to sleep
		  
		  document.getElementById('message').innerHTML =
			  "<table width=80% border=0 cellspacing=0 cellpadding=0><tr><td id='sleepCellA'><font color=red>SLEEPING</font></td><td align=center>Tap image to resume live updates.</td><td align=right id='sleepCellB'><font color=red>SLEEPING</font></td></tr></table>";
		  sleeping = true;
		  setTimeout( blinkSleepingMessage, 1000 );
		  
		  // skip refreshing image src urls
		  return;
	  }

	  resetLoadingFlags();

	  var myImageElementA = document.getElementById('myImageA');
      myImageElementA.src = urlA + '&rand=' + Math.random();
	  
      var myImageElementB = document.getElementById('myImageB');
      myImageElementB.src = urlB + '&rand=' + Math.random();
	  
	  var myImageElementC = document.getElementById('myImageC');
      myImageElementC.src = urlC + '&rand=' + Math.random();

	  var myImageElementD = document.getElementById('myImageD');
      myImageElementD.src = urlD + '&rand=' + Math.random();
	  
	  setTimeout( periodicReload, 500 );
  }
  
  setTimeout( periodicReload, 500 );



  function pickBig( highA, highB, highC, highD ) {
	  lastActivity = Date.now();

	  var myImageElementA = document.getElementById('myImageA');
	  myImageElementA.style.height=highA;
	  var myImageElementB = document.getElementById('myImageB');
	  myImageElementB.style.height=highB;
	  var myImageElementC = document.getElementById('myImageC');
	  myImageElementC.style.height=highC;
	  var myImageElementD = document.getElementById('myImageD');
	  myImageElementD.style.height=highD;

	  if( sleeping ) {
		  sleeping = false;
		  var div = document.getElementById('message');
		  div.innerHTML = "<font color=black>-</font>";
		  div.style.visibility = true;
		  // resume refresh updates
		  periodicReload();
	  }
  }


  function bigA() {
	  pickBig( "58%", "10%", "10%", "10%" );
  }
  function bigB() {
	  pickBig( "10%", "58%", "10%", "10%" );
  }
  function bigC() {
	  pickBig( "10%", "10%", "58%", "10%" );
  }
  function bigD(){
	  pickBig( "10%", "10%", "10%", "58%" );
  }


  document.onkeydown = function( evt ) {
      //evt = evt || window.event;
      if( evt.keyCode == 49 ) {
		  bigA();
	  }
	  else if( evt.keyCode == 50 ) {
		  bigB();
	  }
	  else if( evt.keyCode == 51 ) {
		  bigC();
	  }
	  else if( evt.keyCode == 52 ) {
		  bigD();
	  }
  };

</script>


  </body>

  </html>
